{% extends 'layout.html.twig' %}

{% block title %}
	{{user.username}}'s profile | EtyDict
{% endblock %}

{% block body %}
	<div id="dict-word" class="container fs-5 my-5">
		<div class="card shadow-sm p-5 pb-4 gap-1">
			<div class="px-3 mb-4">
				<div class="card-header m-0 p-0 pt-1 pb-4 bg-white d-flex justify-content-center">
					<div id="word-header" class="d-flex align-items-center gap-5">
						<h1 id="word-title" class="display-6 fw-bold">{{ user.username }}'s profile</h1>
						<p id="join-date" class="fs-5 mb-0">Member since
							{{ date_created }}</p>
					</div>
					<div class="d-flex align-items-center gap-5 pb-0 px-0">
						<div class="d-flex flex-column w-100"></div>
					</div>
				</div>
				<div class="card-body pt-4 pb-2 mx-1 d-flex gap-5 flex-column flex-lg-row align-items-start">
					<table class="flex-grow-0 d-flex">
						<tr>
							<td class="pe-4 pb-3 fw-semibold">Username:</td>
							<td class="pb-3">{{ user.username }}</td>
							<td class="ps-4 pb-3">
								<button type="button" class="btn btn-link p-0" data-profile-target="username-form">Edit</button>
							</td>
						</tr>
						<tr>
							<td class="pe-4 pb-3 fw-semibold">Email:</td>
							<td class="pb-3">{{ user.email }}</td>
							<td class="ps-4 pb-3">
								<button type="button" class="btn btn-link p-0" data-profile-target="email-form">Edit</button>
							</td>
						</tr>
						<tr>
							<td class="pe-4 pb-3 fw-semibold">Password:</td>
							<td class="pb-3">
								<span>********</span>
							</td>
							<td class="ps-4 pb-3">
								<button type="button" class="btn btn-link p-0" data-profile-target="password-form">Change</button>
							</td>
						</tr>
						<tr>
							<td class="pe-4 pb-3 fw-semibold">Status:</td>
							{% if user.is_verified %}
								<td class="pb-3">Verified</td>
							{% else %}
								<td class="pb-3">Not verified</td>
								<td class="ps-4 pb-3">
									<button type="button" class="btn btn-link p-0" data-profile-target="verification-form">Verify</button>
								</td>
								<td></td>
							{% endif %}
						</tr>
					</table>
					<div class="d-flex flex-column gap-4 mt-4 flex-grow-1" id="profile-forms">
						<form hidden id="username-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1">
							<h4 class="pb-3 text-center">Change Username</h4>
							<input type="hidden" name="action" value="editUsername">
							<input type="text" class="form-control mb-3 fs-5" id="username" placeholder="Enter new username" name="editUsername" minlength="8" maxlength="15" value="{{ user.username }}" required>
							<div class="text-center">
								<button type="submit" class="btn btn-primary my-1 fs-5">Confirm</button>
							</div>
						</form>
						<form hidden id="email-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1">
							<h4 class="pb-3 text-center">Change Email</h4>
							<input type="hidden" name="action" value="editEmail">
							<input type="email" class="form-control mb-3 fs-5" id="email" placeholder="Enter new email" name="editEmail" value="{{ user.email }}" required>
							<div class="text-center">
								<button type="submit" class="btn btn-primary my-1 fs-5">Confirm</button>
							</div>
						</form>
						<form hidden id="password-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1 align-items-center">
							<input type="hidden" name="action" value="changePassword">
							<h4 class="pb-3 text-center">Change Password</h4>
							<div class="input-group">
								<input id="profile-password" name="changePassword" type="password" class="form-control form-control-lg" placeholder="Password" value="" required>
								<button type="button" class="btn btn-outline-secondary" data-password-toggle="profile-password" aria-label="Toggle password visibility">
									<span aria-hidden="true"></span>
								</button>
							</div>
							<div class="input-group mt-3">
								<input id="profile-confirm-password" type="password" class="form-control form-control-lg" placeholder="Confirm password" required>
							</div>
							<div class="text-center">
								<button type="submit" class="btn btn-primary my-3 fs-5">Confirm</button>
							</div>
							<small class="text-muted">You will be logged out after changing your password.</small>
							<div class="form-text text-danger mt-1 d-none" id="password-error">
								Password must meet all criteria
							</div>
							<div class="form-text text-danger mt-1 d-none" id="profile-password-match-error">Passwords must match</div>
							<div class="password-criteria mt-3 ">
								<p class="fw-semibold mb-2">Password must contain:</p>
								<ol id="password-criteria" class="list-unstyled mb-0">
									<li class="" data-criteria="length">At least 8 characters</li>
									<li class="" data-criteria="uppercase">1 Uppercase character
										<strong>(A-Z)</strong>
									</li>
									<li class="" data-criteria="lowercase">1 Lowercase character
										<strong>(a-z)</strong>
									</li>
									<li class="" data-criteria="number">1 Number
										<strong>(0-9)</strong>
									</li>
									<li class="" data-criteria="special">1 Special character
										<strong>(!$#%)</strong>
									</li>
								</ol>
							</div>
						</form>
						<form id="verification-form" hidden action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1">
							<input type="hidden" name="action" value="sendMessage">
							<h4 class="pb-3 text-center">Send Verification Request</h4>
							<label for="subject" class="form-label">Subject:</label>
							<input type="text" class="form-control mb-3" id="subject" placeholder="Enter message subject" name="subject" value="User verification" disabled>
							<input type="text" name="subject" value="User verification" hidden required>
							<label for="message" class="form-label">Message:</label>
							<textarea class="form-control" rows="5" id="message" placeholder="Enter Message" name="message" required>Provide any additional verification details.</textarea>
							<button type="submit" class="mt-3 btn btn-primary">Submit</button>
						</form>
					</div>
				</div>
				<form class="px-3 pb-2 mt-4" method="post" action="{{ url }}account/profile/" id="deactivate-form">
					<input type="hidden" name="action" value="deactivateUser">
					<button type="submit" class="btn btn-danger" disabled>Deactivate Account</button>
				</form>
			</div>
		</div>
	</div>
{% endblock %}
{% block user_nav %}
	{% if user is defined and user %}
		{% include 'user_nav.html.twig' %}
	{% endif %}
{% endblock %}

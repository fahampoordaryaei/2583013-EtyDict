{% extends 'layout.html.twig' %}

{% block title %}
	{{user.username}}'s profile | EtyDict Dictionary and Etymology Explorer
{% endblock %}

{% block user_nav %}
	{% if user is defined and user %}
		{% include 'user_nav.html.twig' %}
	{% endif %}
{% endblock %}

{% block body %}
	{% if edit_response is defined and edit_response %}
		<div id="dict-word" class="container fs-5 mb-5 mt-3">
			<div class="mt-0 alert alert-success alert-dismissible" role="alert">
				<p class="text-center p-0 m-0 text-black">{{ edit_response }}</p>
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		{% else %}
			<div id="dict-word" class="container fs-5 my-5 p-0">
			{% endif %}
			<div class="card shadow-sm p-5 pb-4 gap-1">
				<div class="px-3 mb-4">
					<div class="card-header m-0 p-0 pt-1 pb-4 bg-white d-flex justify-content-center">
						<div id="word-header" class="d-flex align-items-center gap-5">
							<h1 id="word-title" class="display-6 fw-bold">{{ user.username }}'s profile</h1>
							<p id="join-date" class="fs-5 mb-0">Member since
								{{ date_created }}</p>
						</div>
						<div class="d-flex align-items-center gap-5 pb-0 px-0">
							<div class="d-flex flex-column w-100"></div>
						</div>
					</div>
					<div class="card-body pt-4 pb-2 mx-1 d-flex gap-5 flex-column flex-lg-row align-items-start">
						<div class="d-flex align-content-center flex-column align-items-center">
							<table class="flex-grow-0 d-flex">
								<tr>
									<td class="pe-4 pb-3 fw-semibold">Username:</td>
									<td class="pb-3">{{ user.username }}</td>
									<td class="ps-4 pb-3">
										<button type="button" class="btn btn-link p-0 profile-target-btn" aria-controls="username-form">Edit</button>
									</td>
								</tr>
								<tr>
									<td class="pe-4 pb-3 fw-semibold">Email:</td>
									<td class="pb-3">{{ user.email }}</td>
									<td class="ps-4 pb-3">
										<button type="button" class="btn btn-link p-0 profile-target-btn" aria-controls="email-form">Edit</button>
									</td>
								</tr>
								<tr>
									<td class="pe-4 pb-3 fw-semibold">Password:</td>
									<td class="pb-3">
										<span>********</span>
									</td>
									<td class="ps-4 pb-3">
										<button type="button" class="btn btn-link p-0 profile-target-btn" aria-controls="password-form">Change</button>
									</td>
								</tr>
							</table>
							<form class="mt-5" method="post" action="{{ url }}account/profile/" id="deactivate-form">
								<input type="hidden" name="action" value="deactivateUser">
								<button type="submit" class="btn btn-danger">Deactivate Account</button>
							</form>
						</div>
						<div class="d-flex flex-column gap-4 mt-4 flex-grow-1" id="profile-forms">
							<form hidden id="username-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1">
								<h4 class="pb-3 text-center">Change Username</h4>
								<input type="hidden" name="action" value="editUsername">
								<input type="text" class="form-control mb-3 fs-5" id="username" placeholder="Enter new username" name="editUsername" minlength="8" maxlength="15" value="{{ user.username }}" required>
								<div class="text-center">
									<button type="submit" class="btn btn-primary my-1 fs-5">Confirm</button>
								</div>
							</form>
							<form hidden id="email-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1">
								<h4 class="pb-3 text-center">Change Email</h4>
								<input type="hidden" name="action" value="editEmail">
								<input type="email" class="form-control mb-3 fs-5" id="email" placeholder="Enter new email" name="editEmail" value="{{ user.email }}" required>
								<div class="text-center">
									<button type="submit" class="btn btn-primary my-1 fs-5">Confirm</button>
								</div>
							</form>
							<form hidden id="password-form" action="{{ url }}account/profile/" method="post" class="fs-5 flex-grow-1 align-items-center">
								<input type="hidden" name="action" value="changePassword">
								<h4 class="pb-3 text-center">Change Password</h4>
								<div class="input-group">
									<input id="profile-password" name="changePassword" type="password" class="form-control form-control-lg" placeholder="Password" value="" required>
									<button type="button" class="btn btn-outline-secondary password-toggle-btn" aria-controls="profile-password" aria-label="Toggle password visibility">
										<span aria-hidden="true"></span>
									</button>
								</div>
								<div class="input-group mt-3">
									<input id="profile-confirm-password" type="password" class="form-control form-control-lg" placeholder="Confirm password" required>
								</div>
								<div class="text-center">
									<button type="submit" class="btn btn-primary my-3 fs-5">Submit</button>
								</div>
								<small class="text-muted">You will be logged out after changing your password.</small>
								<div class="form-text text-danger mt-1 d-none" id="password-error">
									Password must meet all criteria
								</div>
								<div class="form-text text-danger mt-1 d-none" id="profile-password-match-error">Passwords must match</div>
								<div class="password-criteria mt-3 ">
									<p class="fw-semibold mb-2">Password must contain:</p>
									<ol id="password-criteria" class="list-unstyled mb-0">
										<li class="password-criteria-item criteria-length">At least 8 characters</li>
										<li class="password-criteria-item criteria-uppercase">1 Uppercase character
											<strong>(A-Z)</strong>
										</li>
										<li class="password-criteria-item criteria-lowercase">1 Lowercase character
											<strong>(a-z)</strong>
										</li>
										<li class="password-criteria-item criteria-number">1 Number
											<strong>(0-9)</strong>
										</li>
										<li class="password-criteria-item criteria-special">1 Special character
											<strong>(!$#%)</strong>
										</li>
									</ol>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="deactivate-account-modal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header justify-content-center my-1">
						<p class="modal-title fs-4 fw-semibold w-100 text-center position-absolute">Are you sure?</p>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body text-center">
						<p class="fs-5 mb-0">You will not be able to reactivate your account.</p>
					</div>
					<div class="modal-footer border-0 d-flex justify-content-center">
						<button type="button" class="btn btn-danger" id="deactivate-confirm-btn">I'm sure</button>
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Nevermind</button>
					</div>
				</div>
			</div>
		</div>
	{% endblock %}
